<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chat App</title>
    <link rel="stylesheet" href="styles.css">
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>
    <div id="drag-overlay" style="display:none; position:fixed; inset:0; background:rgba(0,172,230,0.2); border:5px dashed #00ACE6; z-index:9999; pointer-events:none; align-items:center; justify-content:center;">
        <h1 style="color:white;">Drop Image Here</h1>
    </div>

    <div id="chat-container">
        <div id="messages" style="height:400px; overflow-y:auto; background:#222;"></div>
        <input type="text" id="msg-input" placeholder="Type or drop image...">
    </div>

    <script>
        const socket = io();
        const overlay = document.getElementById('drag-overlay');
        const messages = document.getElementById('messages');

        // Drag & Drop Listeners
        window.addEventListener('dragover', (e) => { e.preventDefault(); overlay.style.display = 'flex'; });
        window.addEventListener('dragleave', () => { overlay.style.display = 'none'; });
        window.addEventListener('drop', (e) => {
            e.preventDefault();
            overlay.style.display = 'none';
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                const formData = new FormData();
                formData.append('file', file);
                fetch('/upload', { method: 'POST', body: formData })
                    .then(r => r.json())
                    .then(data => {
                        socket.emit('chat-message', { image: data.url, text: '', channel: 'main' });
                    });
            }
        });

        socket.on('chat-message', (msg) => {
            const div = document.createElement('div');
            if (msg.image) div.innerHTML = `<img src="${msg.image}" style="max-width:200px; display:block;">`;
            if (msg.text) div.innerText = msg.text;
            messages.appendChild(div);
        });
    </script>
</body>
</html>
